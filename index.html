<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LumoNet - Messagerie</title>
<style>
@font-face {
  font-family: 'LumoNet';
  src: url('font.otf') format('opentype');
}

/* ------------------- Body ------------------- */
body {
  margin: 0;
  font-family: LumoNet, sans-serif;
  background: url('https://media.idownloadblog.com/wp-content/uploads/2025/06/iOS-26-Wallpaper-by-iSpazio-for-iPhone.jpg') no-repeat center center fixed;
  background-size: cover;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ------------------- Header ------------------- */
header {
  padding: 20px;
  text-align: center;
  font-size: 1.5em;
  font-weight: bold;
  color: #fff;
  background: rgba(0,128,128,0.3);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

/* ------------------- Screens ------------------- */
.screen {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  padding: 10px;
  box-sizing: border-box;
  overflow-y: auto;
}

/* ------------------- Glass Card ------------------- */
.glass-card {
  width: 90%;
  max-width: 400px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  color: #fff;
  position: relative;
  text-align: center;
  transition: transform 0.2s;
}

.glass-card:hover {
  transform: translateY(-5px);
}

/* ------------------- Buttons ------------------- */
.button {
  padding: 10px 20px;
  border: none;
  border-radius: 25px;
  background: rgba(0,128,128,0.8);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.3s;
  margin: 5px 0;
}

.button:hover {
  background: rgba(0,128,128,1);
}

/* ------------------- Input ------------------- */
input, .chat-input input, .popup input {
  width: 100%;
  padding: 10px 15px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.4);
  background: rgba(255,255,255,0.1);
  color: #fff;
  outline: none;
  margin-bottom: 10px;
  box-sizing: border-box;
}

/* Placeholder blanc */
input::placeholder {
  color: rgba(255,255,255,0.6);
}

/* ------------------- Contacts ------------------- */
.contacts {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: 15px;
  align-items: center;
}

.contact-card {
  width: 90%;
  padding: 15px;
  border-radius: 20px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  position: relative;
}

.contact-card:hover {
  background: rgba(255,255,255,0.2);
}

/* Delete button */
.contact-card .delete-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  background: none;
  border: none;
  font-size: 1.2em;
  color: red;
  cursor: pointer;
}

/* ------------------- Chat ------------------- */
.chat {
  display: none;
  flex-direction: column;
  width: 100%;
}

.messages {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  margin-bottom: 10px;
}

.message {
  max-width: 70%;
  padding: 10px 15px;
  border-radius: 16px;
  word-wrap: break-word;
}

.message.me {
  align-self: flex-end;
  background: rgba(0,128,128,0.8);
  color: #fff;
}

.message.their {
  align-self: flex-start;
  background: rgba(255,255,255,0.2);
  color: #fff;
}

/* Chat input */
.chat-input {
  display: flex;
  gap: 10px;
  width: 90%;
  margin-bottom: 10px;
}

.chat-input input {
  flex: 1;
}

.back-btn {
  align-self: flex-start;
  padding: 10px 15px;
  border: none;
  border-radius: 25px;
  background: rgba(0,128,128,0.6);
  color: #fff;
  cursor: pointer;
  margin-bottom: 10px;
}

.back-btn:hover {
  background: rgba(0,128,128,1);
}

/* ------------------- Popup ------------------- */
.popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(15px);
  padding: 20px;
  border-radius: 20px;
  color: #fff;
  z-index: 100;
  width: 90%;
  max-width: 350px;
  text-align: center;
}

.popup .close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5em;
  background: none;
  border: none;
  color: #fff;
  cursor: pointer;
}

.popup #popupAddBtn {
  background: rgba(0,128,128,0.8);
  color: #fff;
  padding: 10px 20px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  margin-top: 10px;
  font-family: LumoNet, sans-serif;
  font-weight: bold;
  transition: background 0.3s;
}

.popup #popupAddBtn:hover {
  background: rgba(0,128,128,1);
}

#sendBtn {
  background: rgba(255,255,255,0.1); /* semi-transparent */
  backdrop-filter: blur(10px);        /* effet glass */
  color: #fff;
  padding: 10px 20px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  font-family: LumoNet, sans-serif;
  font-weight: bold;
  transition: background 0.3s, transform 0.2s;
}

#sendBtn:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}
/* ------------------- Responsive ------------------- */
@media(max-width:500px){
  .chat-input input, .chat-input button, .popup input, .button {
    font-size: 14px;
    padding: 8px;
  }
  header { font-size: 1.2em; }
}
</style>
</head>

<body>
<header>LumoNet</header>

<!-- Popup ajout contact -->
<div class="popup" id="popupAddContact">
  <button class="close-btn" onclick="popupAddContact.style.display='none'">×</button>
  <h2>Ajouter un contact</h2>
  <input type="text" id="popupName" placeholder="Nom du contact">
  <input type="text" id="popupToken" placeholder="Token Bark">
  <button id="popupAddBtn">Ajouter</button>
</div>

<!-- Écran contacts -->
<div class="screen" id="contactsScreen">
  <button class="button" onclick="popupAddContact.style.display='block'">Ajouter un contact</button>
  <div class="contacts" id="contactsList"></div>
</div>

<!-- Écran chat -->
<div class="screen chat" id="chatScreen">
  <button class="back-btn" id="backBtn">← Retour</button>
  <h2 id="welcome"></h2>
  <div class="messages" id="messages"></div>
  <div class="chat-input">
    <input type="text" id="chatMessage" placeholder="Tape ton message ici !">
    <button id="sendBtn">Envoyer</button>
  </div>
</div>

<script>
// ------------------- Variables -------------------
let currentUserName = localStorage.getItem('currentUserName');
if(!currentUserName){
  currentUserName = prompt("Entrez votre nom d'utilisateur :") || "Utilisateur";
  localStorage.setItem('currentUserName', currentUserName);
}
const currentUser = encodeURIComponent(currentUserName.toLowerCase());
const currentUserAvatar = "https://i.postimg.cc/MKKbzJbY/default-avatar.jpg";

let contacts = JSON.parse(localStorage.getItem('contacts')) || [];
let currentRecipientToken = '';
let currentRecipientName = '';

const contactsList = document.getElementById('contactsList');
const contactsScreen = document.getElementById('contactsScreen');
const chatScreen = document.getElementById('chatScreen');
const messagesContainer = document.getElementById('messages');
const chatMessageInput = document.getElementById('chatMessage');
const welcome = document.getElementById('welcome');
const backBtn = document.getElementById('backBtn');

const popupAddContact = document.getElementById('popupAddContact');
const popupName = document.getElementById('popupName');
const popupToken = document.getElementById('popupToken');
const popupAddBtn = document.getElementById('popupAddBtn');

// ------------------- Fonctions -------------------
function renderContacts(){
  contactsList.innerHTML = '';
  contacts.forEach((contact,index)=>{
    const card = document.createElement('div');
    card.className='contact-card glass-card';
    card.textContent = contact.name;
    card.dataset.token = contact.token;

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent="×";
    deleteBtn.className="delete-btn";
    deleteBtn.addEventListener('click', e=>{
      e.stopPropagation();
      contacts.splice(index,1);
      localStorage.setItem('contacts',JSON.stringify(contacts));
      renderContacts();
    });
    card.appendChild(deleteBtn);
    card.addEventListener('click',()=>openChat(contact));
    contactsList.appendChild(card);
  });
}

function openChat(contact){
  currentRecipientToken = contact.token;
  currentRecipientName = contact.name;
  contactsScreen.style.display='none';
  chatScreen.style.display='flex';
  messagesContainer.innerHTML='';
  welcome.textContent=`Chat avec ${contact.name}`;
}

function addMessage(text,me=true){
  const msgDiv = document.createElement('div');
  msgDiv.className='message '+(me?'me':'their');
  msgDiv.textContent=text;
  messagesContainer.appendChild(msgDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function sendMessage(){
  const message = chatMessageInput.value.trim();
  if(!message || !currentRecipientToken){ alert('Écris un message !'); return; }
  addMessage(message,true);
  const token = encodeURIComponent(currentRecipientToken);
  const msg = encodeURIComponent(message);
  const icon = encodeURIComponent(currentUserAvatar);
  const url = `https://api.day.app/${token}/${currentUser}/${msg}?icon=${icon}`;
  const iframe = document.createElement('iframe');
  iframe.style.display='none';
  iframe.src=url;
  document.body.appendChild(iframe);
  chatMessageInput.value='';
  setTimeout(()=>document.body.removeChild(iframe),5000);
}

// Ajouter un contact
popupAddBtn.addEventListener('click',()=>{
  const name=popupName.value.trim();
  const token=popupToken.value.trim();
  if(!name || !token){ alert('Nom et token obligatoires !'); return; }
  contacts.push({name,token});
  localStorage.setItem('contacts',JSON.stringify(contacts));
  popupName.value='';
  popupToken.value='';
  popupAddContact.style.display='none';
  renderContacts();

  // Notification Bark
  const msg=encodeURIComponent(`Le contact ${name} a été ajouté par ${currentUserName} ! ✅`);
  const icon=encodeURIComponent(currentUserAvatar);
  const url=`https://api.day.app/${token}/${currentUser}/${msg}?icon=${icon}`;
  const iframe=document.createElement('iframe');
  iframe.style.display='none';
  iframe.src=url;
  document.body.appendChild(iframe);
  setTimeout(()=>document.body.removeChild(iframe),5000);
});

// Retour
backBtn.addEventListener('click',()=>{
  chatScreen.style.display='none';
  contactsScreen.style.display='flex';
  currentRecipientToken='';
  currentRecipientName='';
});

// Envoyer message
chatMessageInput.addEventListener('keydown', e=>{ if(e.key==='Enter') sendMessage(); });
document.getElementById('sendBtn').addEventListener('click',sendMessage);

renderContacts();
</script>
</body>
</html>
