async function send() {
  const message = chatMessage.value.trim();
  if (!message) {
    alert('Écris un message !');
    return;
  }

  // Vérif du destinataire
  console.log(">>> currentRecipient =", currentRecipient);

  // Ajout local
  addMessage(message, true);
  chatMessage.value = '';

  const body = { recipient: currentRecipient, message };
  console.log(">>> body envoyé :", body);

  const res = await fetch('/api/send', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  console.log(">>> réponse serveur :", data);

  if (!data.ok) {
    if (res.status === 401) {
      window.location.href = '/login.html';
    } else {
      alert('Erreur : ' + (data.error || 'inconnue'));
    }
  }
}
